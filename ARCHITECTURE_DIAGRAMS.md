# ğŸ“Š System Architecture & Data Flow Diagrams

## 1. Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DIGITAL HYDROPONIC SYSTEM                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    HARDWARE      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DS18B20 Sensor  â”‚  Temperature sensor on GPIO 4
â”‚  (connected to   â”‚  Reads temperature every 60 seconds
â”‚   ESP32 GPIO 4)  â”‚  Accuracy: Â±0.5Â°C
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ WiFi (60 sec interval)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ARDUINO / ESP32                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  File: Water-sensor/sensor.ino           â”‚
â”‚  - Reads temperature from sensor         â”‚
â”‚  - Connects to WiFi (Joseph-WIFI)        â”‚
â”‚  - Sends HTTP POST request               â”‚
â”‚  - Retries every 30 sec if WiFi down     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP POST
         â”‚ {temperature, user_id, sensor_id, timestamp}
         â”‚ Headers: Authorization: Bearer API_KEY
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SUPABASE CLOUD FUNCTION                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Endpoint:                                   â”‚
â”‚  /functions/v1/record-temperature           â”‚
â”‚                                              â”‚
â”‚  File: supabase/functions/record-temperatureâ”‚
â”‚  - Validates HTTP method (POST only)        â”‚
â”‚  - Parses JSON body                         â”‚
â”‚  - Validates temperature range              â”‚
â”‚  - Validates user_id                        â”‚
â”‚  - Connects to PostgreSQL                   â”‚
â”‚  - Inserts with default constants           â”‚
â”‚  - Returns HTTP 201 on success              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ SQL INSERT
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    POSTGRESQL DATABASE (Supabase)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Table: farming_data                              â”‚
â”‚  â”œâ”€â”€ id: UUID (auto)                              â”‚
â”‚  â”œâ”€â”€ user_id: UUID                                â”‚
â”‚  â”œâ”€â”€ sensor_id: string                            â”‚
â”‚  â”œâ”€â”€ temperature: numeric (variable)              â”‚
â”‚  â”œâ”€â”€ ph_level: numeric (6.5 default)              â”‚
â”‚  â”œâ”€â”€ ec_level: numeric (1.2 default)              â”‚
â”‚  â”œâ”€â”€ co2_level: numeric (400 default)             â”‚
â”‚  â”œâ”€â”€ ndvi_value: numeric (0.5 default)            â”‚
â”‚  â”œâ”€â”€ recorded_at: timestamp                       â”‚
â”‚  â”œâ”€â”€ location: string                             â”‚
â”‚  â””â”€â”€ created_at: timestamp (auto)                 â”‚
â”‚                                                   â”‚
â”‚  Triggers: Real-time subscription enabled        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Realtime INSERT event
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     REACT FRONTEND (Dashboard)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  subscribeToTemperatureChanges()           â”‚
â”‚      â†“                                     â”‚
â”‚  TemperatureMonitor Component              â”‚
â”‚      â†“                                     â”‚
â”‚  State Update                              â”‚
â”‚      â†“                                     â”‚
â”‚  UI Re-render                              â”‚
â”‚      â†“                                     â”‚
â”‚  Display New Temperature                   â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     USER INTERFACE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Current Temperature: 25.5Â°C âœ“               â”‚
â”‚  Updated: 10:35:22 AM                        â”‚
â”‚  [âœ“ Optimal]                                 â”‚
â”‚                                              â”‚
â”‚  Today's Statistics:                         â”‚
â”‚  Average: 24.3Â°C                             â”‚
â”‚  Min: 18.2Â°C  â”‚  Max: 28.7Â°C                â”‚
â”‚  12 readings today                           â”‚
â”‚                                              â”‚
â”‚  Recent Readings:                            â”‚
â”‚  #1  25.5Â°C  10:35:22                        â”‚
â”‚  #2  25.3Â°C  10:34:55                        â”‚
â”‚  #3  25.1Â°C  10:34:12                        â”‚
â”‚  ... (7 more)                                â”‚
â”‚                                              â”‚
â”‚  Data Visualization:                         â”‚
â”‚  [Line Chart] [Bar Chart] [Table View]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Request/Response Flow Sequence

```
ARDUINO                    SUPABASE FUNCTION              DATABASE              DASHBOARD
   â”‚                             â”‚                           â”‚                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€POST Requestâ”€â”€â”€â”€â”€â”€â”€â†’â”‚                           â”‚                      â”‚
   â”‚ {temperature: 25.5,         â”‚                           â”‚                      â”‚
   â”‚  user_id: "...",            â”‚                           â”‚                      â”‚
   â”‚  sensor_id: "ESP32_001"}    â”‚                           â”‚                      â”‚
   â”‚                             â”‚                           â”‚                      â”‚
   â”‚                    Validate â”‚                           â”‚                      â”‚
   â”‚                    âœ“ JSON OK â”‚                           â”‚                      â”‚
   â”‚                    âœ“ Temp OK â”‚                           â”‚                      â”‚
   â”‚                    âœ“ ID OK   â”‚                           â”‚                      â”‚
   â”‚                             â”‚                           â”‚                      â”‚
   â”‚                    Prepare  â”‚                           â”‚                      â”‚
   â”‚                    Data     â”‚                           â”‚                      â”‚
   â”‚                             â”‚                           â”‚                      â”‚
   â”‚                             â”‚â”€â”€INSERT INTOâ”€â”€â†’â”‚           â”‚                      â”‚
   â”‚                             â”‚ farming_data   â”‚           â”‚                      â”‚
   â”‚                             â”‚                â”‚â”€TRIGGERâ”€â†’â”‚ Realtime             â”‚
   â”‚                             â”‚                â”‚           â”‚ Subscription         â”‚
   â”‚                             â”‚                â”‚           â”‚â”€EVENTâ”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚      â”‚
   â”‚                             â”‚                â”‚           â”‚               â”‚      â”‚
   â”‚                             â”‚                â”‚  Return  â”‚               â”‚ Update
   â”‚                             â”‚                â”‚  Record  â”‚               â”‚ State
   â”‚â†â”€â”€HTTP 201 Successâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚           â”‚               â”‚
   â”‚   {success: true,          â”‚                â”‚           â”‚ Render       â”‚
   â”‚    data: {id, temp, ...}}  â”‚                â”‚           â”‚ UI          â”‚
   â”‚                             â”‚                â”‚           â”‚               â”‚
   â”‚                             â”‚                â”‚           â”‚               â”‚
   â”‚ [Serial Output]            â”‚                â”‚           â”‚               â”‚
   â”‚ [API] âœ“ Success            â”‚                â”‚           â”‚  Toast:       â”‚
   â”‚ [API] HTTP 201             â”‚                â”‚           â”‚  "New Reading"â”‚
   â”‚ [API] Response: {...}      â”‚                â”‚           â”‚               â”‚
   â”‚                             â”‚                â”‚           â”‚      Display  â”‚
   â”‚                             â”‚                â”‚           â”‚      25.5Â°C âœ“ â”‚
   â”‚                             â”‚                â”‚           â”‚               â”‚
```

---

## 3. Function Processing Steps

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SUPABASE FUNCTION REQUEST HANDLER                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REQUEST ARRIVES
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: METHOD CHECK            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Is method POST?                 â”‚
â”‚   âœ“ Yes â†’ Continue              â”‚
â”‚   âœ— No  â†’ Return 405 Error      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: PARSE JSON              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Is body valid JSON?             â”‚
â”‚   âœ“ Yes â†’ Continue              â”‚
â”‚   âœ— No  â†’ Return 400 Error      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: EXTRACT FIELDS          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Get: temperature, user_id,      â”‚
â”‚      sensor_id, timestamp       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: VALIDATE TEMPERATURE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Field exists?                                 â”‚
â”‚ âœ“ Is number?                                    â”‚
â”‚ âœ“ Not NaN?                                      â”‚
â”‚ âœ“ Between -50 and 150?                          â”‚
â”‚   âœ“ All pass â†’ Continue                         â”‚
â”‚   âœ— Any fail â†’ Return 400 Error                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: VALIDATE USER_ID        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Field exists?                 â”‚
â”‚ âœ“ Is string?                    â”‚
â”‚ âœ“ Non-empty?                    â”‚
â”‚   âœ“ All pass â†’ Continue         â”‚
â”‚   âœ— Any fail â†’ Return 400 Error â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: INIT SUPABASE CLIENT    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Get env variables:              â”‚
â”‚ - SUPABASE_URL                  â”‚
â”‚ - SUPABASE_ANON_KEY             â”‚
â”‚   âœ“ Both exist â†’ Continue       â”‚
â”‚   âœ— Missing   â†’ Return 500 Errorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: PREPARE DATA                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Format: {                           â”‚
â”‚   user_id,                          â”‚
â”‚   sensor_id (or default),           â”‚
â”‚   temperature (2 decimals),         â”‚
â”‚   ph_level (from input or default), â”‚
â”‚   ec_level (from input or default), â”‚
â”‚   co2_level (from input or default),â”‚
â”‚   ndvi_value (from input or default)â”‚
â”‚   recorded_at,                      â”‚
â”‚   location                          â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: INSERT TO DATABASE      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INSERT INTO farming_data (...)  â”‚
â”‚ VALUES (...)                    â”‚
â”‚ RETURNING *                     â”‚
â”‚   âœ“ Success â†’ Continue          â”‚
â”‚   âœ— Error   â†’ Return 500 Error  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: ANALYZE & GENERATE ALERTS       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Check temperature thresholds:           â”‚
â”‚ - If < 15Â°C â†’ Add warning alert        â”‚
â”‚ - If > 35Â°C â†’ Add warning alert        â”‚
â”‚ Otherwise â†’ alerts = null               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 10: CREATE SUCCESS RESPONSE        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HTTP 201 Created                        â”‚
â”‚ {                                       â”‚
â”‚   success: true,                        â”‚
â”‚   message: "...",                       â”‚
â”‚   data: { inserted record },            â”‚
â”‚   alerts: [ warnings if any ]           â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESPONSE SENT TO ARDUINO
     â”‚
     â†“
  âœ“ SUCCESS
  [API] âœ“ Success (HTTP 201)
```

---

## 4. Database Table Structure

```
farming_data TABLE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column Name      â”‚ Type                â”‚ Description            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id               â”‚ UUID (PRIMARY)      â”‚ Record ID (auto)       â”‚
â”‚ user_id          â”‚ UUID (NOT NULL)     â”‚ Supabase user ID       â”‚
â”‚ sensor_id        â”‚ VARCHAR(255)        â”‚ Device identifier      â”‚
â”‚ temperature      â”‚ NUMERIC(5,2)        â”‚ Temp in Â°C (variable)  â”‚
â”‚ ph_level         â”‚ NUMERIC(4,2)        â”‚ pH value (default 6.5) â”‚
â”‚ ec_level         â”‚ NUMERIC(5,2)        â”‚ EC value (default 1.2) â”‚
â”‚ co2_level        â”‚ NUMERIC(7,2)        â”‚ CO2 ppm (default 400)  â”‚
â”‚ ndvi_value       â”‚ NUMERIC(4,2)        â”‚ NDVI (default 0.5)     â”‚
â”‚ location         â”‚ VARCHAR(255)        â”‚ Sensor location        â”‚
â”‚ recorded_at      â”‚ TIMESTAMP WITH TZ   â”‚ Reading timestamp      â”‚
â”‚ created_at       â”‚ TIMESTAMP (DEFAULT) â”‚ Record creation time   â”‚
â”‚ updated_at       â”‚ TIMESTAMP (DEFAULT) â”‚ Last update time       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example Row:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 550e8400-... â”‚ 68172449-... â”‚ ESP32_001 â”‚ 25.50 â”‚ 6.50 â”‚ ...   â”‚
â”‚ 2025-11-21   â”‚ 10:35:45 UTC â”‚ 2025-11-21 10:35:47 UTC           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Real-Time Subscription Flow

```
DATABASE CHANGE DETECTED
       â”‚
       â†“ PostgreSQL Trigger
SUPABASE REALTIME ENGINE
       â”‚
       â†“ INSERT event
WEBSOCKET EVENT EMITTED
       â”‚
       â†“
ALL SUBSCRIBED CLIENTS RECEIVE UPDATE
       â”‚
       â”œâ”€â†’ Dashboard (TemperatureMonitor)
       â”‚       â”‚
       â”‚       â†“
       â”‚   Callback executed:
       â”‚   subscribeToTemperatureChanges((newData) => {
       â”‚     setCurrentTemp(newData.temperature)
       â”‚     setReadings([newData, ...])
       â”‚     toast("New Reading")
       â”‚   })
       â”‚       â”‚
       â”‚       â†“
       â”‚   State Updated
       â”‚       â”‚
       â”‚       â†“
       â”‚   Component Re-renders
       â”‚       â”‚
       â”‚       â†“
       â”‚   UI Shows: 25.5Â°C âœ“
       â”‚
       â””â”€â†’ Other subscribers...
```

---

## 6. Temperature Ranges & Status

```
TEMPERATURE SCALE WITH STATUS

 -50Â°C    0Â°C     15Â°C    20Â°C    30Â°C    35Â°C    150Â°C
  â”‚       â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  â„ï¸   â”‚  ğŸ¥¶   â”‚  ğŸ¥¶   â”‚  âœ“   â”‚  âœ“   â”‚  ğŸ”¥   â”‚  ğŸ”¥
  â”‚ FREEZEâ”‚ COLD  â”‚ COOL  â”‚OPTIMALâ”‚WARM  â”‚ HOT  â”‚DANGER
  â”‚       â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜

Color Coding:
  ğŸ”µ Blue     < 10Â°C  (Too cold)
  ğŸ”µ Cyan    10-20Â°C  (Cold)
  ğŸŸ¢ Green   20-30Â°C  (Optimal)
  ğŸŸ  Orange  30-40Â°C  (Warm)
  ğŸ”´ Red      > 40Â°C  (Too hot)

Thresholds:
  âš ï¸  WARNING_LOW = 15Â°C (triggers alert)
  âš ï¸  WARNING_HIGH = 35Â°C (triggers alert)
```

---

## 7. File Organization

```
Digital-Hydroponic/
â”‚
â”œâ”€â”€ Hardware
â”‚   â””â”€â”€ Water-sensor/
â”‚       â””â”€â”€ sensor.ino                 â† Arduino code
â”‚
â”œâ”€â”€ Backend
â”‚   â””â”€â”€ supabase/
â”‚       â””â”€â”€ functions/
â”‚           â””â”€â”€ record-temperature/
â”‚               â”œâ”€â”€ index.ts           â† Main function (CURRENT)
â”‚               â”œâ”€â”€ index-optimized.ts â† Better version
â”‚               â”œâ”€â”€ index-enhanced.ts  â† Advanced version
â”‚               â””â”€â”€ deno.json
â”‚
â”œâ”€â”€ Frontend
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ pages/
â”‚       â”‚   â”œâ”€â”€ Dashboard.tsx          â† Main overview
â”‚       â”‚   â””â”€â”€ DataVisualization.tsx  â† Charts & data
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ TemperatureMonitor.tsx â† Live display
â”‚       â”‚   â””â”€â”€ DashboardLayout.tsx    â† Navigation
â”‚       â””â”€â”€ services/
â”‚           â””â”€â”€ temperatureService.ts  â† Data service
â”‚
â””â”€â”€ Documentation
    â”œâ”€â”€ PROJECT_WALKTHROUGH.md         â† Full architecture
    â”œâ”€â”€ SUPABASE_FUNCTION_GUIDE.md     â† Function reference
    â”œâ”€â”€ IMPLEMENTATION_GUIDE.md        â† Deployment guide
    â”œâ”€â”€ QUICK_REFERENCE.md             â† Quick lookup
    â”œâ”€â”€ CODE_PACKAGE_SUMMARY.md        â† Code overview
    â””â”€â”€ ARCHITECTURE_DIAGRAMS.md       â† This file
```

---

## 8. Component Hierarchy

```
App
â”‚
â””â”€â”€ DashboardLayout
    â”œâ”€â”€ NavLink components (navigation)
    â”‚   â”œâ”€â”€ Home â†’ Dashboard
    â”‚   â”œâ”€â”€ Daily Summary â†’ DailySummary
    â”‚   â”œâ”€â”€ Data Analytics â†’ DataVisualization
    â”‚   â”œâ”€â”€ Email Settings â†’ EmailSettings
    â”‚   â””â”€â”€ Messages â†’ Messages
    â”‚
    â””â”€â”€ Outlet (routed component)
        â”‚
        â”œâ”€ Dashboard.tsx
        â”‚   â””â”€â”€ Display:
        â”‚       â”œâ”€â”€ Total data points
        â”‚       â”œâ”€â”€ Average temperature
        â”‚       â”œâ”€â”€ Average pH
        â”‚       â””â”€â”€ Message count
        â”‚
        â”œâ”€ DataVisualization.tsx
        â”‚   â””â”€â”€ Display:
        â”‚       â”œâ”€â”€ Line chart (temperature trend)
        â”‚       â”œâ”€â”€ Bar chart (all factors)
        â”‚       â””â”€â”€ Table (detailed data)
        â”‚
        â””â”€ TemperatureMonitor.tsx (embedded in all)
            â””â”€â”€ Real-time display:
                â”œâ”€â”€ Current temperature
                â”œâ”€â”€ Today's statistics
                â”œâ”€â”€ Sensor status
                â””â”€â”€ Recent readings (10)
```

---

## 9. Data Types & Validation

```
REQUEST VALIDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Field            â”‚ Type    â”‚ Required â”‚ Range/Validation       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ temperature      â”‚ Number  â”‚ YES      â”‚ -50 to 150Â°C           â”‚
â”‚ user_id          â”‚ String  â”‚ YES      â”‚ Non-empty string       â”‚
â”‚ sensor_id        â”‚ String  â”‚ NO       â”‚ Any string             â”‚
â”‚ timestamp        â”‚ ISO 8601â”‚ NO       â”‚ Valid date format      â”‚
â”‚ ph_level         â”‚ Number  â”‚ NO       â”‚ Any number (0-14)      â”‚
â”‚ ec_level         â”‚ Number  â”‚ NO       â”‚ Any number             â”‚
â”‚ co2_level        â”‚ Number  â”‚ NO       â”‚ Any number             â”‚
â”‚ ndvi_value       â”‚ Number  â”‚ NO       â”‚ Any number (-1 to 1)   â”‚
â”‚ location         â”‚ String  â”‚ NO       â”‚ Any string             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ERROR CODES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Code     â”‚ Meaning                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 201      â”‚ âœ… Created - Success                                â”‚
â”‚ 400      â”‚ âŒ Bad Request - Invalid data                       â”‚
â”‚ 405      â”‚ âŒ Method Not Allowed - Must be POST                â”‚
â”‚ 500      â”‚ âŒ Server Error - Database/Config error             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Communication Protocols

```
ARDUINO â†’ SUPABASE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Protocol:  HTTP/HTTPS                                          â”‚
â”‚ Method:    POST                                                â”‚
â”‚ Endpoint:  https://PROJECT.supabase.co/functions/v1/record-   â”‚
â”‚            temperature                                         â”‚
â”‚ Content-Type: application/json                                â”‚
â”‚ Headers:                                                       â”‚
â”‚   - Authorization: Bearer {ANON_KEY}                           â”‚
â”‚   - Content-Type: application/json                             â”‚
â”‚ Interval:  Every 60 seconds                                    â”‚
â”‚ Retry:     Every 30 seconds if WiFi down                       â”‚
â”‚ Timeout:   10 seconds                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SUPABASE â†’ FRONTEND
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Protocol:  WebSocket (Realtime)                                â”‚
â”‚ Channel:   farming_data_changes                                â”‚
â”‚ Event:     INSERT (new temperature added)                      â”‚
â”‚ Filter:    user_id = authenticated user                        â”‚
â”‚ Speed:     <1 second latency                                   â”‚
â”‚ Connection: Persistent (auto-reconnect)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**System is fully operational! âœ…**
All components integrated and working correctly.
